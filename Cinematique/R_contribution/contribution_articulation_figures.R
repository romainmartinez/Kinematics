#   Description:
#       contribution_articulation_traitement is used to generate figures
#   Output:
#       contribution_articulation_traitement gives figures in pdf, svg and Rdata
#   Author:  Romain Martinez
#   email:   martinez.staps@gmail.com
#   Website: https://github.com/romainmartinez
#_____________________________________________________________________________

# preparation ----------------------------------------------------------------
# packages
lapply(c("tidyr", "dplyr", "ggplot2", "readxl", "magrittr", "knitr", "grid", "ggthemes", "ggradar", "scales"),
       require,
       character.only = T)
# path
setwd("C:/Users/marti/Documents/Codes/Kinematics/Cinematique/R_contribution/")

# switch
plot_gantt  <- TRUE
plot_radar  <- TRUE
variable    <- 'hauteur'
comparison  <- 'relative'

# load data ---------------------------------------------------------------
datapath <- file.path("//10.89.24.15/e/Projet_IRSST_LeverCaisse/ElaboratedData/contribution_articulation/SPM",
                      paste(variable, "_", comparison, ".xlsx", sep = ""))

data.sheet <- c("anova", "interaction", "mainA", "mainB")
for (isheet in 1:4) {
  assign(data.sheet[isheet],
         read_excel(datapath,
                    sheet = data.sheet[isheet],
                    na = "NA"))
  }
# reshape data ------------------------------------------------------------
factor.delta <- function(x){
  factor(x = x, levels = c(1:4), labels = c("hand + EL", "GH", "SCAC", "RoB"))
}

factor.height <- function(x){
  factor(x = x,levels = c(1,2,4,3,5,6),
                   labels = c("hips-shoulders","hips-eyes","shoulders-eyes","shoulders-hips","eyes-hips","eyes-shoulders"))
  }

anova$delta <- anova$delta %>% factor.delta
interaction$delta <- interaction$delta %>% factor.delta
mainA$delta <- mainA$delta %>% factor.delta
mainB$delta <- mainB$delta %>% factor.delta

interaction$height <- interaction$height %>% factor.height

# Create output table -----------------------------------------------------
# saveRDS(data.sex,"output/table.posthoc.sex.rds")
# saveRDS(data.height,"output/table.posthoc.height.rds")

# gantt plot --------------------------------------------------------------
source("functions/plot.gantt.R")
plot.gantt(interaction, annotation = FALSE, save = TRUE, scale.free = FALSE)


# test --------------------------------------------------------------------
# data.0d.sex <- data.0d.sex  %>%
#   gather(key = key, value = value, 4:9) %>%
#   separate(key, c("valeur", "sex"), sep = "_") %>%
#   spread(valeur, value)
# 
# bar <- ggplot(data = zeroD_bar, aes(x = delta, y = moy, fill = sex))
# bar <- bar + geom_bar(stat = "identity", position = position_dodge())
# bar <- bar + facet_grid(height ~ weight)
# bar